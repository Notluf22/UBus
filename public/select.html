 <!DOCTYPE html>
<html>
<head>
  <title>UBus - Selected Bus</title>
  <link rel="icon" href="logo-transparent-png.png" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
      background: rgb(152, 166, 139);
      padding: 20px;
    }
    .bus-details {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 120px auto 0 auto;
      animation: slideUp 1s ease-out;
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .bus-details h2 { font-size: 45px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .bus-details p { font-size: large; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 8px 0; }
    .button {
      background-color: green;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      display: block;
      width: 60%;
      margin-left: 20%;
    }
    .button:hover { background-color: rgb(1, 70, 1); }
  </style>
</head>
<body>

<div class="bus-details" id="busDetails">
  <h2>Selected Bus</h2>
  <p>Loading bus information...</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // ‚úÖ Supabase setup
  const SUPABASE_URL = "https://wztfguawfjvjuvkwairh.supabase.co";
  const SUPABASE_KEY = "YOUR_SUPABASE_ANON_KEY";
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  function toTitleCase(str) {
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
  }

  const selectedBusId = sessionStorage.getItem("selectedBusId");

  async function loadBusDetails() {
    const busDetailsDiv = document.getElementById("busDetails");
    busDetailsDiv.innerHTML = "<p>Loading bus information...</p>";

    if (!selectedBusId) {
      busDetailsDiv.innerHTML = "<p>No bus selected. Please go back and select a bus.</p>";
      return;
    }

    try {
      // Fetch the bus from Supabase
      const { data: bus, error } = await supabase
        .from('buses')
        .select('*')
        .eq('bus_id', selectedBusId)
        .single();

      if (error || !bus) throw error;

      // Determine fare dynamically based on route stops
      const route = (bus.route || []).map(stop => stop.toLowerCase());
      const source = route[0]; // first stop
      const destination = route[route.length - 1]; // last stop
      const stopCount = route.length - 1;

      let ratePerStop = bus.bus_type.toLowerCase() === "super fast" ? 15 :
                        bus.bus_type.toLowerCase() === "fast" ? 12 : 10;
      const fare = stopCount * ratePerStop;

      busDetailsDiv.innerHTML = `
        <h2>${bus.bus_type} üöå</h2>
        <p><strong>Bus ID:</strong> ${bus.bus_id}</p>
        <p><strong>Route:</strong> ${toTitleCase(source)} ‚ûù ${toTitleCase(destination)}</p>
        <p><strong>Departure:</strong> ${bus.departure_time} from ${bus.boarding_point}</p>
        <p><strong>Arrival:</strong> ${bus.arrival_time} at ${bus.dropping_point}</p>
        <p><strong>Duration:</strong> ${bus.duration}</p>
        <p><strong>Fare:</strong> ‚Çπ${fare}</p>
        <button class="button" onclick="proceedToBooking()">Proceed to Booking</button>
      `;
    } catch (err) {
      console.error("Error loading bus:", err);
      busDetailsDiv.innerHTML = "<p>‚ö†Ô∏è Failed to load bus details.</p>";
    }
  }

  function proceedToBooking() {
    window.location.href = "booking.html";
  }

  document.addEventListener("DOMContentLoaded", loadBusDetails);
</script>

</body>
</html>
